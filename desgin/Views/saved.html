<section class="listings">
    <h1 class="heading">Latest Listings</h1>
    <div class="box-container" id="box-container">
        <!-- Boxes will be dynamically loaded here -->
    </div>
    <div style="margin-top: 2rem; text-align:center;">
        <a href="#listings" class="inline-btn">View All</a>
    </div>
</section>

<!-- Add your JavaScript code here -->
<script>
    // Function to make AJAX request
    function loadJSON(url, callback) {
        var xhr = new XMLHttpRequest();
        xhr.overrideMimeType("application/json");
        xhr.open('GET', url, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == "200") {
                callback(xhr.responseText);
            }
        };
        xhr.send(null);
    }

    // Usage
    loadJSON('http://localhost:63342/Game-shop/desgin/Assets/js/pets.json', function (response) {
        var petsData = JSON.parse(response);

        loadJSON('http://localhost:63342/Game-shop/desgin/Assets/js/breeds.json', function (breedResponse) {
            var breedsData = JSON.parse(breedResponse);

            loadJSON('http://localhost:63342/Game-shop/desgin/Assets/js/caontons.json', function (cantonsResponse) {
                var cantonsData = JSON.parse(cantonsResponse);

                loadJSON('http://localhost:63342/Game-shop/desgin/Assets/js/users.json', function (ownersResponse) {
                    var ownersData = JSON.parse(ownersResponse);
                    console.log("Owners Data:", ownersData);

                    const boxContainerHome = document.getElementById('box-container');
                    const userId = localStorage.getItem('userId');
                    console.log(userId);

                    // Loop through all pets and create box elements
                    petsData.forEach(function(pet) {
                        if (parseInt(pet.owner) === parseInt(userId)) { // Check if owner is 1
                            const box = document.createElement('div');
                            box.classList.add('box');

                            // Admin info
                            const admin = document.createElement('div');
                            admin.classList.add('admin');

                            const owner = ownersData.find(owner => owner.id === pet.owner);

                            if (owner) {
                                const ownerLabel = document.createElement('h4');
                                ownerLabel.textContent = "Owner: ";
                                admin.appendChild(ownerLabel);

                                const ownerName = document.createElement('h5');
                                ownerName.textContent = owner.name;
                                admin.appendChild(ownerName);
                            } else {
                                console.log('Owner not found');
                            }

                            box.appendChild(admin);

                            // Thumbnail and image
                            const thumb = document.createElement('div');
                            thumb.classList.add('thumb');

                            const totalImages = document.createElement('p');
                            totalImages.classList.add('total-images');
                            totalImages.innerHTML = `<i class="far fa-image"></i><span>${pet.images.length}</span>`;
                            thumb.appendChild(totalImages);

                            const img = document.createElement('img');
                            img.src = `Assets/images/${pet.images[0]}`;
                            img.alt = pet.name;
                            thumb.appendChild(img);

                            box.appendChild(thumb);

                            // Pet info
                            const petName = document.createElement('h3');
                            petName.classList.add('name');
                            petName.textContent = pet.name;
                            box.appendChild(petName);

                            const category = document.createElement('p');
                            category.classList.add('type');
                            const petCategory = breedsData.breeds.find(breed => breed.id === pet.type);
                            category.innerHTML = `<i class="fas fa-paw"></i><span>${petCategory ? petCategory.category : 'Unknown'}</span>`;
                            box.appendChild(category);

                            const locationName = document.createElement('p');
                            locationName.classList.add('location');
                            const petLocation = cantonsData.find(canton => canton.id === pet.location);
                            locationName.innerHTML = `<i class="fas fa-paw"></i><span>${petLocation ? petLocation.name : 'Unknown'}</span>`;
                            box.appendChild(locationName);

                            const detailsFlex = document.createElement('div');
                            detailsFlex.classList.add('flex');

                            const age = document.createElement('p');
                            age.innerHTML = `<i class="fas fa-calendar"></i><span>${pet.age} years</span>`;
                            detailsFlex.appendChild(age);

                            const price = document.createElement('p');
                            price.innerHTML = `<i class="fas fa-money-bill"></i><span>$${pet.price}</span>`;
                            detailsFlex.appendChild(price);

                            const location = document.createElement('p');
                            location.innerHTML = `<i class="fas fa-location-dot"></i><span>${pet.location}</span>`;
                            detailsFlex.appendChild(location);

                            box.appendChild(detailsFlex);

                            const viewBtn = document.createElement('a');
                            viewBtn.href = '#view_pet';
                            viewBtn.classList.add('btn');
                            viewBtn.textContent = 'View Pet';
                            box.appendChild(viewBtn);

                            boxContainerHome.appendChild(box);
                        }
                    });
                });
            });
        });
    });
</script>
</body>
</html>